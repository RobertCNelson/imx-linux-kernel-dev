From 65c5a25a46eb1d00da6cf8ead0eb163c306a1569 Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Thu, 17 Sep 2015 15:44:37 -0500
Subject: [PATCH 68/97] apply backport patch
 collateral-evolutions/network/0054-struct-proto_ops-sig/nfc.patch

---
 backports/net/nfc/llcp_sock.c | 10 ++++++++++
 backports/net/nfc/rawsock.c   | 10 ++++++++++
 2 files changed, 20 insertions(+)

diff --git a/backports/net/nfc/llcp_sock.c b/backports/net/nfc/llcp_sock.c
index 9578bd6..03bbe8c 100644
--- a/backports/net/nfc/llcp_sock.c
+++ b/backports/net/nfc/llcp_sock.c
@@ -750,8 +750,13 @@ error:
 	return ret;
 }
 
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(4,1,0)
 static int llcp_sock_sendmsg(struct socket *sock, struct msghdr *msg,
 			     size_t len)
+#else
+static int llcp_sock_sendmsg(struct kiocb *iocb, struct socket *sock,
+			     struct msghdr *msg, size_t len)
+#endif
 {
 	struct sock *sk = sock->sk;
 	struct nfc_llcp_sock *llcp_sock = nfc_llcp_sock(sk);
@@ -793,8 +798,13 @@ static int llcp_sock_sendmsg(struct socket *sock, struct msghdr *msg,
 	return nfc_llcp_send_i_frame(llcp_sock, msg, len);
 }
 
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(4,1,0)
 static int llcp_sock_recvmsg(struct socket *sock, struct msghdr *msg,
 			     size_t len, int flags)
+#else
+static int llcp_sock_recvmsg(struct kiocb *iocb, struct socket *sock,
+			     struct msghdr *msg, size_t len, int flags)
+#endif
 {
 	int noblock = flags & MSG_DONTWAIT;
 	struct sock *sk = sock->sk;
diff --git a/backports/net/nfc/rawsock.c b/backports/net/nfc/rawsock.c
index 82b4e80..a01e342 100644
--- a/backports/net/nfc/rawsock.c
+++ b/backports/net/nfc/rawsock.c
@@ -211,7 +211,12 @@ static void rawsock_tx_work(struct work_struct *work)
 	}
 }
 
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(4,1,0)
 static int rawsock_sendmsg(struct socket *sock, struct msghdr *msg, size_t len)
+#else
+static int rawsock_sendmsg(struct kiocb *iocb, struct socket *sock,
+			   struct msghdr *msg, size_t len)
+#endif
 {
 	struct sock *sk = sock->sk;
 	struct nfc_dev *dev = nfc_rawsock(sk)->dev;
@@ -247,8 +252,13 @@ static int rawsock_sendmsg(struct socket *sock, struct msghdr *msg, size_t len)
 	return len;
 }
 
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(4,1,0)
 static int rawsock_recvmsg(struct socket *sock, struct msghdr *msg, size_t len,
 			   int flags)
+#else
+static int rawsock_recvmsg(struct kiocb *iocb, struct socket *sock,
+			   struct msghdr *msg, size_t len, int flags)
+#endif
 {
 	int noblock = flags & MSG_DONTWAIT;
 	struct sock *sk = sock->sk;
-- 
2.5.1

